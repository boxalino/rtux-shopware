{% sw_extends '@Storefront/storefront/component/analytics.html.twig' %}
{% block component_head_analytics %}
    {{ parent() }}

    {% set rtuxApiTracker = null %}
    {% if context.getExtension("rtuxApiTracker") is defined %}
        {% set rtuxApiTracker = context.getExtension("rtuxApiTracker") %}
    {% endif %}

    {% if rtuxApiTracker and rtuxApiTracker.isActive() %}
        {% block component_boxalino_api_tracker_js %}
            <script async src="{{ rtuxApiTracker.getUrl() }}"></script>
            <script>
                window.rtuxApiTrackerActive = true;
                window.controllerName = '{{ controllerName|lower }}';
                window.actionName = '{{ controllerAction|lower }}';
                window.activeNavigationId = '{{ page.header.navigation.active.id }}';
                window.currentCurrency = '{{ page.header.activeCurrency.translated.shortName }}';
                window._bxq = window._bxq || [];
                window.preferentialLog = '{{ rtuxApiTracker.getCustomerContext() }}';

                function bxq(arguments) { _bxq.push(arguments); }

                window.bxqCallback = () => {
                    bxq(['setAccount', '{{ rtuxApiTracker.getAccount() }}']);
                    bxq(['trackPageView']);
                    {% if rtuxApiTracker.isTest() %}
                    bxq(['debugCookie', true]);
                    {% endif %}
                };
            </script>
        {% endblock %}
    {% endif %}
{% endblock %}
